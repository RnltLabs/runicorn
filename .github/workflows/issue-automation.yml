name: Issue Automation

on:
  issues:
    types: [opened, edited]

jobs:
  auto-label-priority:
    runs-on: ubuntu-latest
    permissions:
      issues: write
    steps:
      - name: Add priority labels
        uses: actions/github-script@v7
        with:
          script: |
            const issue = context.payload.issue;
            const body = issue.body || '';

            // Extract priority from issue body
            const priorityMatch = body.match(/### Priority\s*\n\s*([^\n]+)/i);

            if (priorityMatch) {
              const priority = priorityMatch[1].trim();
              const labelMap = {
                'High': 'priority:high',
                'Critical': 'priority:critical'
              };

              const label = labelMap[priority];
              if (label) {
                await github.rest.issues.addLabels({
                  owner: context.repo.owner,
                  repo: context.repo.repo,
                  issue_number: issue.number,
                  labels: [label]
                });
                console.log(`Added label: ${label}`);
              }
            }
